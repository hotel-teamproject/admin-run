version: '3.8'

services:
  # ▼▼▼ [수정 1] 서비스 이름을 'whotel-mongodb'로 변경 (코드와 일치시킴) ▼▼▼
  whotel-mongodb:
    image: mongo:latest
    container_name: whotel-mongodb
    restart: always
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_DATABASE: hotel-project
    volumes:
      - mongodb_data:/data/db
    networks:
      - hotel-network

  # ▼▼▼ [수정 2] 백엔드 서비스 이름도 whotel-backend로 통일 ▼▼▼
  whotel-backend:
    build:
      context: ./backend-admin-main
      dockerfile: Dockerfile.dev
    container_name: whotel-backend
    restart: always
    ports:
      - "4000:4000"
    environment:
      # ▼▼▼ MongoDB 연결: .env 파일의 MONGO_URI 사용 (Atlas 또는 로컬) ▼▼▼
      - MONGO_URI=${MONGO_URI:-mongodb://whotel-mongodb:27017/hotel-project}
      - MONGODB_URI=${MONGODB_URI:-${MONGO_URI:-mongodb://whotel-mongodb:27017/hotel-project}}
      
      - JWT_SECRET=${JWT_SECRET}
      - JWT_EXPIRES_IN=${JWT_EXPIRES_IN:-1h}
      - REFRESH_TOKEN_SECRET=${REFRESH_TOKEN_SECRET:-${JWT_SECRET}}
      - REFRESH_EXPIRES_IN=${REFRESH_EXPIRES_IN:-7d}
      - PORT=${PORT:-4000}
      - NODE_ENV=${NODE_ENV:-development}
      - FRONT_ORIGIN=${FRONT_ORIGIN:-http://localhost:5173}
    depends_on:
      - whotel-mongodb
    volumes:
      - ./backend-admin-main:/app
      - /app/node_modules
    networks:
      - hotel-network
    command: npm run dev

  # ▼▼▼ [수정 4] 프론트엔드 서비스 이름도 whotel-frontend로 통일 ▼▼▼
  whotel-frontend:
    build:
      context: ./frontend-admin-main
      dockerfile: Dockerfile.dev
    container_name: whotel-frontend
    restart: always
    ports:
      - "5173:5173"
    environment:
      - VITE_API_URL=${VITE_API_URL:-http://localhost:4000/api}
    volumes:
      - ./frontend-admin-main:/app
      - /app/node_modules
    networks:
      - hotel-network
    command: npm run dev -- --host

volumes:
  mongodb_data:

networks:
  hotel-network:
    driver: bridge