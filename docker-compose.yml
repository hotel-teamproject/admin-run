version: '3.8'

services:
  # Atlas를 사용하므로 로컬 DB 서비스는 필수가 아니지만, 
  # 필요에 따라 유지하거나 주석 처리하셔도 됩니다.
  whotel-mongodb:
    image: mongo:latest
    container_name: whotel-mongodb
    restart: always
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_DATABASE: hotel-project
    volumes:
      - mongodb_data:/data/db
    networks:
      - hotel-network

  whotel-backend:
    build:
      context: ./backend-admin-main
      dockerfile: Dockerfile.dev
    container_name: whotel-backend
    restart: always
    ports:
      - "4000:4000" # 외부 포트 4000번 사용
    environment:
      # ▼▼▼ [수정됨] MongoDB Atlas 연결 주소 적용 ▼▼▼
      - MONGO_URI=mongodb+srv://dr701050:1234@cluster0.ntbddof.mongodb.net/hotel-project?retryWrites=true&w=majority&appName=Cluster0
      - MONGODB_URI=mongodb+srv://dr701050:1234@cluster0.ntbddof.mongodb.net/hotel-project?retryWrites=true&w=majority&appName=Cluster0
      
      - JWT_SECRET=${JWT_SECRET}
      - JWT_EXPIRES_IN=${JWT_EXPIRES_IN:-1h}
      - REFRESH_TOKEN_SECRET=${REFRESH_TOKEN_SECRET:-${JWT_SECRET}}
      - REFRESH_EXPIRES_IN=${REFRESH_EXPIRES_IN:-7d}
      - PORT=4000 # 포트 번호를 Docker 포트(4000)와 일치시킴
      - NODE_ENV=development
      - FRONT_ORIGIN=${FRONT_ORIGIN:-http://localhost:5173}
    depends_on:
      - whotel-mongodb
    volumes:
      - ./backend-admin-main:/app
      - /app/node_modules
    networks:
      - hotel-network
    command: npm run dev

  whotel-frontend:
    build:
      context: ./frontend-admin-main
      dockerfile: Dockerfile.dev
    container_name: whotel-frontend
    restart: always
    ports:
      - "5173:5173"
    environment:
      # 프론트엔드에서 바라볼 백엔드 주소 (로컬 테스트 시)
      - VITE_API_URL=http://localhost:4000/api 
    volumes:
      - ./frontend-admin-main:/app
      - /app/node_modules
    networks:
      - hotel-network
    command: npm run dev -- --host

volumes:
  mongodb_data:

networks:
  hotel-network:
    driver: bridge